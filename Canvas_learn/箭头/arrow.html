<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./index.css">
    <script src="./jquery.js"></script>
    <script src="./index.js"></script>
    <script src="./generatorArr.js"></script>
</head>

<body>
    <canvas id="myCanvas" width="1000" height="200"></canvas>
    <div class="init-img-container">
        <!-- <img src="./images/User2.png" alt="" class="userImg"> -->
    </div>

    <script>
        // 并行网关 ParallelGateway sid-3BBAB7C4-BE18-47B3-8B1F-89321BD01A4D
        // 排他网关 ExclusiveGateway sid-22CCD18B-DFFD-498E-8E05-43CEB0193DE5

        const myCanvas = document.getElementById("myCanvas");
        const ctx = myCanvas.getContext("2d");
        let arr = [{
                id: 1,
                nodes: [{
                    nid: "sid-01",
                    name: '发起节点',
                    msg: '请快速办理'
                }],
                nodeCount: 1,
                xStart: 50,
                xTo: 150
            },
            {
                id: 2,
                nodes: [{
                    nid: "sid-02",
                    name: '在办节点一',
                    msg: '我好着急啊MMP'
                }],
                nodeCount: 1,
                xStart: 200,
                xTo: 300
            },
            {
                id: 3,
                nodes: [{
                    nid: "sid-03",
                    name: '会签节点一',
                    msg: '我好着急啊MMP'
                }, {
                    nid: "sid-04",
                    name: '会签节点二',
                    msg: '我好着急啊MMP'
                }],
                nodeCount: 2,
                xStart: 350,
                xTo: 450
            },
            {
                id: 4,
                nodes: [{
                    nid: "sid-05",
                    name: '总经理审批',
                    msg: '我好着急啊MMP'
                }],
                nodeCount: 1,
                xStart: 500,
                xTo: 600
            }
        ]
        // arr = generatorArr()
        arr = [{
                "nodes": [{
                    "resourceId": "sid-FBF72118-82BB-4E76-96CD-2412174D9B5A",
                    "name": "节点一",
                    "msg": "请快速办理",
                    "assignee": "王万里"
                }],
                "nodeCount": 1,
                "xStart": -100,
                "xTo": 0,
                "type": "UserTask"
            },
            {
                "nodes": [{
                    "resourceId": "sid-24C40488-750C-4E1B-ADC2-AB0D235B84C8",
                    "name": "节点二",
                    "msg": "请快速办理",
                    "assignee": "王万里"
                }],
                "nodeCount": 1,
                "xStart": 50,
                "xTo": 150,
                "type": "UserTask"
            },
            {
                "nodes": [{
                    "resourceId": "sid-638726AE-A734-4CC8-B986-25EEFF1609C6",
                    "name": "排他网关",
                    "msg": "请快速办理",
                    "assignee": ""
                }],
                "nodeCount": 1,
                "xStart": 200,
                "xTo": 300,
                "type": "ExclusiveGateway"
            },
            {
                "nodes": [{
                    "resourceId": "sid-2ED45D0D-5095-48D5-8739-16B296FD5213",
                    "name": "售前项目",
                    "msg": "请快速办理",
                    "assignee": "zhengyue"
                }],
                "nodeCount": 1,
                "xStart": 350,
                "xTo": 450,
                "type": "UserTask"
            }
        ]
        console.log(arr)
        arr.forEach((item, index) => {
            if (index === 0) {
                var htmlFragment = `
                    <div class="img-container" style="left:${item.xTo}px">
                        <img src="./images/User2.png" alt="" class="userImg">
                        <p>${item.nodes[0].name}</p>
                        <p>${item.nodes[0].assignee}</p>
                    </div>
                `
            } else {
                if (item.nodeCount === 1) {
                    drawArrow(ctx, item.xStart, 100, item.xTo, 100, 30, 15, 3, '#f36');
                    writeText(ctx, item.xStart, 110, 0, item.nodes[0].msg)
                    if (item.type === "ExclusiveGateway") {
                        var htmlFragment = `
                        <div class="img-container" style="left:${item.xTo}px">
                            <img src="./images/User4.png" alt="" class="userImg">
                            <p>${item.nodes[0].name}</p>
                            <p>${item.nodes[0].assignee}</p>
                        </div>
                    `
                    } else {
                        var htmlFragment = `
                            <div class="img-container" style="left:${item.xTo}px">
                                <img src="./images/User2.png" alt="" class="userImg">
                                <p>${item.nodes[0].name}</p>
                                <p>${item.nodes[0].assignee}</p>
                            </div>
                        `
                    }

                } else if (item.nodeCount === 2) {
                    drawArrow(ctx, item.xStart, 100, item.xTo, 50, 30, 15, 3, '#f36');
                    drawArrow(ctx, item.xStart, 100, item.xTo, 150, 30, 15, 3, '#f36');
                    // writeText(ctx, item.xStart, 50, 0.2, item.nodes[0].msg)
                    // writeText(ctx, item.xStart, 150, -0.2, item.nodes[1].msg)
                    var htmlFragment = `
                    <div class="img-container" style="left:${item.xTo}px;top:0">
                        <img src="./images/User2.png" alt="" class="userImg">
                        <p>${item.nodes[0].name}</p>
                        <p>${item.nodes[0].assignee}</p>
                    </div>
                    <div class="img-container" style="left:${item.xTo}px;top:100px">
                        <img src="./images/User2.png" alt="" class="userImg">
                        <p>${item.nodes[1].name}</p>
                        <p>${item.nodes[1].assignee}</p>
                    </div>
                `
                } else {

                }
            }

            $("body").append(htmlFragment)
        })
    </script>
</body>

</html>